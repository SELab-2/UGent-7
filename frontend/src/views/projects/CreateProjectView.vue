<script setup lang="ts">
import Calendar from 'primevue/calendar'
import BaseLayout from '@/components/layout/BaseLayout.vue'
import Title from '@/components/layout/Title.vue'
import { ref } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { useI18n } from 'vue-i18n'
import InputText from 'primevue/inputtext'
import Textarea from 'primevue/textarea'
import Button from 'primevue/button'
import InputNumber from 'primevue/inputnumber'
import InputSwitch from 'primevue/inputswitch'
import { Project } from '@/types/Projects'
import { useProject } from '@/composables/services/project.service'

/* Composable injections */
const { t } = useI18n()
const { push } = useRouter()
const { params } = useRoute()

/* Service injection */
const { createProject } = useProject()

const projectName = ref<string>('')
const projectDescription = ref<string>('')
const projectStartDate = ref<Date>(new Date())
const projectDeadline = ref<Date>(new Date())
const groupSize = ref<number>(1)
const maxScore = ref<number>(10)
const visibility = ref<boolean>(true)
const scoreVisibility = ref<boolean>(false)

const submitProject = async (): Promise<void> => {
    // Pass the project data to the service
    await createProject(
        new Project(
            '', // ID not needed for creation, will be generated by the backend
            projectName.value,
            projectDescription.value,
            visibility.value,
            false, // Default not archived
            false, // Default the groups are not locked
            projectStartDate.value,
            projectDeadline.value,
            maxScore.value,
            scoreVisibility.value,
            groupSize.value
        ),
        params.courseId as string
    )

    // Redirect to the dashboard overview
    push({ name: 'dashboard' })
}
</script>

<template>
    <BaseLayout>
        <div class="grid fadein">
            <div class="col-12 md:col-6">
                <!-- Create project heading -->
                <Title class="mb-6">{{ t('views.projects.create') }}</Title>

                <!-- Project form -->
                <form @submit.prevent="submitProject">
                    <!-- Project name -->
                    <div class="mb-4">
                        <label for="projectName">{{
                            t('views.projects.name')
                        }}</label>
                        <InputText
                            id="projectName"
                            v-model="projectName"
                            required
                        />
                    </div>

                    <!-- Project description -->
                    <div class="mb-4">
                        <label for="projectDescription">{{
                            t('views.projects.description')
                        }}</label>
                        <Textarea
                            id="projectDescription"
                            v-model="projectDescription"
                            autoResize
                            rows="5"
                            cols="30"
                        />
                    </div>

                    <!-- Start date of the project -->
                    <div class="mb-4">
                        <label for="projectStartDate">{{
                            t('views.projects.start_date')
                        }}</label>
                        <Calendar
                            id="projectStartDate"
                            v-model="projectStartDate"
                            view="date"
                            dateFormat="dd-mm-yy"
                            required
                        />
                    </div>

                    <!-- Deadline of the project -->
                    <div class="mb-4">
                        <label for="projectDeadline">{{
                            t('views.projects.deadline')
                        }}</label>
                        <Calendar
                            id="projectDeadline"
                            v-model="projectDeadline"
                            view="date"
                            dateFormat="dd-mm-yy"
                            required
                        />
                    </div>

                    <!-- Group size for the project -->
                    <div class="mb-4">
                        <label for="groupSize">{{
                            t('views.projects.group_size')
                        }}</label>
                        <InputNumber
                            id="groupSize"
                            v-model="groupSize"
                            :min="1"
                            required
                        />
                    </div>

                    <!-- Max score for the project -->
                    <div class="mb-4">
                        <label for="maxScore">{{
                            t('views.projects.max_score')
                        }}</label>
                        <InputNumber
                            id="maxScore"
                            v-model="maxScore"
                            :min="1"
                            required
                        />
                    </div>

                    <!-- Visibility of the project -->
                    <div class="mb-4">
                        <label for="visibility">{{
                            t('views.projects.visibility')
                        }}</label>
                        <InputSwitch id="visibility" v-model="visibility" />
                    </div>

                    <!-- Score visibility of the project -->
                    <div class="mb-4">
                        <label for="scoreVisibility">{{
                            t('views.projects.score_visibility')
                        }}</label>
                        <InputSwitch
                            id="scoreVisibility"
                            v-model="scoreVisibility"
                        />
                    </div>

                    <!-- Submit button -->
                    <div class="flex justify-end">
                        <Button
                            :label="t('views.projects.create')"
                            type="submit"
                            icon="pi pi-check"
                            iconPos="right"
                            rounded
                        />
                    </div>
                </form>
            </div>
        </div>
    </BaseLayout>
</template>

<style scoped>
/* Flex column layout for label and input */
.mb-4 {
    display: flex;
    flex-direction: column;
}

/* Add margin between label and input */
label {
    margin-bottom: 0.5rem;
}
</style>
